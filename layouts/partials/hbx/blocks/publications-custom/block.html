{{/* Publications Custom Block: left title | right list; honors design.spacing & container */}}
{{ $b := .wcBlock }}

{{/* Spacing & container */}}
{{ $pad := $b.design.spacing.padding | default (slice "0.75rem" "0" "0.75rem" "0") }}
{{ $container := $b.design.container | default "max-w-6xl" }}

{{/* Query publications and sort by date desc */}}
{{ $publications := where site.RegularPages "Section" "publications" }}
{{ $publications = where $publications ".Draft" false }}
{{ $publications = sort $publications "Date" "desc" }}

<section class="relative overflow-hidden"
  style="padding: {{ index $pad 0 }} {{ index $pad 1 }} {{ index $pad 2 }} {{ index $pad 3 }};">
  <div class="{{ $container }} mx-auto px-4">
    <!-- 响应式网格: 移动端单列, 桌面端双列 -->
    <div class="grid items-start gap-6 md:grid-cols-1 lg:grid-cols-[13rem_1fr]">
      <!-- Title -->
      <div class="lg:sticky lg:top-6">
        {{ with $b.content.title }}
          <h2 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white m-0">{{ . }}</h2>
        {{ end }}
      </div>

      <!-- List -->
      <div class="space-y-4 md:space-y-6">
        {{ range $publications }}
          <article class="flex flex-col sm:flex-row gap-4 sm:gap-6 p-4 sm:p-5 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow">
            {{ $featured := .Resources.GetMatch "featured*" }}
            {{ if $featured }}
              <!-- 移动端: 全宽图片, 桌面端: 固定宽度 -->
              <img src="{{ $featured.RelPermalink }}" alt="{{ .Title }}" class="w-full sm:w-24 h-48 sm:h-24 object-cover rounded-lg sm:shrink-0">
            {{ end }}

            <div class="flex-1 min-w-0">
              <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-1 hover:text-blue-600 dark:hover:text-blue-400">
                {{ if .Params.url }}
                  <a href="{{ .Params.url }}" target="_blank" rel="noopener">{{ .Title }}</a>
                {{ else }}
                  <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                {{ end }}
              </h3>

              {{ with .Params.authors }}
                <!-- 移动端不截断, 桌面端截断 -->
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1 sm:truncate">{{ delimit . ", " }}</p>
              {{ end }}

              {{ with .Params.publication }}
                <p class="text-sm sm:text-base text-blue-600 dark:text-blue-400 font-medium mb-2">{{ . }}</p>
              {{ end }}

              {{ with .Params.abstract }}
                <p class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed mb-2">
                  {{ . | truncate 200 }}
                </p>
              {{ end }}

              <div class="flex gap-2 flex-wrap">
                {{ with .Params.url }}<a href="{{ . }}" target="_blank" rel="noopener" class="inline-flex items-center px-2.5 py-1 text-xs font-medium text-blue-600 bg-blue-50 rounded-full dark:bg-blue-900 dark:text-blue-200 hover:bg-blue-100 dark:hover:bg-blue-800 transition-colors">📄 Paper</a>{{ end }}
                {{ with .Params.url_pdf }}<a href="{{ . }}" target="_blank" rel="noopener" class="inline-flex items-center px-2.5 py-1 text-xs font-medium text-red-600 bg-red-50 rounded-full dark:bg-red-900 dark:text-red-200 hover:bg-red-100 dark:hover:bg-red-800 transition-colors">📑 PDF</a>{{ end }}
                {{ with .Params.url_code }}<a href="{{ . }}" target="_blank" rel="noopener" class="inline-flex items-center px-2.5 py-1 text-xs font-medium text-green-600 bg-green-50 rounded-full dark:bg-green-900 dark:text-green-200 hover:bg-green-100 dark:hover:bg-green-800 transition-colors">💻 Code</a>{{ end }}
                {{ with .Params.url_dataset }}<a href="{{ . }}" target="_blank" rel="noopener" class="inline-flex items-center px-2.5 py-1 text-xs font-medium text-purple-600 bg-purple-50 rounded-full dark:bg-purple-900 dark:text-purple-200 hover:bg-purple-100 dark:hover:bg-purple-800 transition-colors">📊 Dataset</a>{{ end }}
              </div>

              <div class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                {{ .Date.Format "January 2006" }}
              </div>
            </div>
          </article>
        {{ end }}
      </div>
    </div>
  </div>
</section>